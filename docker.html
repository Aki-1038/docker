<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8"> <!-- è¨­å®šå­—å…ƒç·¨ç¢¼ç‚º UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- é©æ‡‰è¡Œå‹•è£ç½® -->
    <title>docker</title> <!-- ç¶²é æ¨™é¡Œ -->
    <!-- å¼•å…¥ Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- å¼•å…¥ SweetAlert CSS å’Œ JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* è‡ªè¨‚æ¨£å¼ */
        .chat-box {
            height: 600px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #f9f9f9;
        }
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
        }
        .user-message {
            background-color: #d1e7dd;
            color: #0f5132;
            margin-left: auto; /* é å³å°é½Š */
            max-width: fit-content;
        }
        .bot-message {
            background-color: #e2e3e5;
            color: #41464b;
            margin-right: auto; /* é å·¦å°é½Š */
            max-width: fit-content;
        }

        /* æ‹–æ›³ç¬¦è™Ÿæ¨£å¼ */
        .drag-icon {
            cursor: grab;
        }

        /* åƒåœ¾æ¡¶ç¬¦è™Ÿæ¨£å¼ */
        .delete-icon {
            cursor: pointer;
            color: red;
        }

        /* ç·¨è¼¯ç¬¦è™Ÿæ¨£å¼ */
        .edit-icon {
            cursor: pointer;
            color: blue;
            margin-left: 10px;
        }

        /* å¦å­˜æ–°æª”ç¬¦è™Ÿæ¨£å¼ */
        .save-icon {
            cursor: pointer;
            color: green;
            margin-left: 10px;
        }

        /* åƒåœ¾æ¡¶å’Œæ‹–æ›³ç¬¦è™Ÿå®¹å™¨æ¨£å¼ */
        .icons-container {
            display: flex;
            align-items: center;
        }

        /* å‹•ç•«æ•ˆæœ */
        .list-group-item.active {
            background-color: #61dcf4; /* èƒŒæ™¯é¡è‰² */
            color: white; /* æ–‡å­—é¡è‰² */
            transition: background-color 0.3s ease, color 0.3s ease; /* å‹•ç•«éæ¸¡æ•ˆæœ */
        }
        /* å­—é«”å¤§å°æ§åˆ¶ç¬¦è™Ÿæ¨£å¼ */
        .font-size-icon {
            cursor: pointer;
            margin-left: 10px;
            font-size: 20px;
        }


    </style>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <!-- å°è©±æ¨™é¡Œåˆ—è¡¨ -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0">å°è©±åˆ—è¡¨</h6>
                        <button class="btn btn-secondary btn-sm" type="button" onclick="addConversation()">æ–°å¢å°è©±</button>
                    </div>
                    <div class="card-body">
                        <ul id="conversationList" class="list-group"></ul>
                    </div>
                </div>
            </div>
            <!-- èŠå¤©æ¡† -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0" id="conversationTitle">docker</h6>
                        <div class="d-flex align-items-center">
                            <span class="font-size-icon ms-2" onclick="changeFontSize('increase')">æ”¾å¤§ â•</span>
                            <span class="font-size-icon ms-2" onclick="changeFontSize('decrease')">ç¸®å° â–</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- èŠå¤©æ¡† -->
                        <div class="chat-box mb-3" id="chatBox"> </div>
                        <!-- è¼¸å…¥æ¡† -->
                        <div class="input-group">
                            <input type="text" id="userMessage" class="form-control" placeholder="è«‹è¼¸å…¥è¨Šæ¯" style="white-space: pre-wrap;">
                            <button class="btn btn-primary" type="button" onclick="sendMessage()">ç™¼é€</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ Bootstrap JS å’Œä¾è³´ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // è®€å– localStorage è³‡æ–™   
        let pageIdentifier = window.location.pathname.replace(/\//g, '') || 'p1';
        const conversationTitlesKey = 'docker1_conversationTitles'; // å°è©±æ¨™é¡Œçš„ localStorage éµxxx_conversationTitles

        let chatHistory = []; // åˆå§‹åŒ–èŠå¤©æ­·å²è¨˜éŒ„æ•¸çµ„
        let conversationTitles = []; // åˆå§‹åŒ–å°è©±æ¨™é¡Œæ•¸çµ„

        // å¾ localStorage ä¸­è®€å–èŠå¤©æ­·å²
        function loadChatHistory(identifier) {
            const savedChatHistory = localStorage.getItem(identifier + '_chatHistory');
            if (savedChatHistory) {
                chatHistory = JSON.parse(savedChatHistory);
                updateChatBox();
            } else {
                chatHistory = [];
                updateChatBox();
            }
            highlightSelectedItem(identifier);
        }

        // å¾ localStorage ä¸­è®€å–å°è©±æ¨™é¡Œ
        function loadConversationTitles() {
            const savedTitles = localStorage.getItem(conversationTitlesKey);
            if (savedTitles) {
                conversationTitles = JSON.parse(savedTitles);
                updateConversationList();
            } else {
                conversationTitles = [];
            }
        }

        // ä¿å­˜èŠå¤©æ­·å²åˆ° localStorage
        function saveChatHistory(identifier) {
            localStorage.setItem(identifier + '_chatHistory', JSON.stringify(chatHistory));
        }

        // ä¿å­˜å°è©±æ¨™é¡Œåˆ° localStorage
        function saveConversationTitles() {
            localStorage.setItem(conversationTitlesKey, JSON.stringify(conversationTitles));
        }
        function updateChatBox() {
            const chatBox = document.getElementById("chatBox"); // ç²å–èŠå¤©æ¡†å…ƒç´ 
            chatBox.innerHTML = ''; // æ¸…ç©ºèŠå¤©æ¡†å…§å®¹
            chatHistory.forEach(message => { // éæ­·èŠå¤©æ­·å²
                const msgElement = document.createElement("div"); // å‰µå»ºä¸€å€‹æ–°çš„ div å…ƒç´ 
                msgElement.classList.add("message"); // æ·»åŠ æ¶ˆæ¯æ¨£å¼
                msgElement.classList.add(message.sender === 'user' ? "user-message" : "bot-message"); // æ ¹æ“šæ¶ˆæ¯ç™¼é€è€…æ·»åŠ å°æ‡‰çš„æ¨£å¼
                // æ›¿æ›ä½¿ç”¨è€…æ¶ˆæ¯ä¸­çš„æ›è¡Œç¬¦ç‚º<br>ä»¥ä¾¿æ–¼é¡¯ç¤º
                msgElement.innerHTML = message.text.replace(/\n/g, '<br>'); // ä½¿ç”¨ innerHTML ä¾†æ”¯æ´æ›è¡Œæ¨™ç±¤
                msgElement.style.fontSize = fontSize + 'px'; // è¨­å®šå­—é«”å¤§å°
                chatBox.appendChild(msgElement); // å°‡æ¶ˆæ¯å…ƒç´ æ·»åŠ åˆ°èŠå¤©æ¡†
            });
            chatBox.scrollTop = chatBox.scrollHeight; // è®“èŠå¤©æ¡†æ»¾å‹•åˆ°åº•éƒ¨
        }

        function sendMessage() {
            const userMessage = document.getElementById("userMessage").value; // ç²å–ä½¿ç”¨è€…è¼¸å…¥çš„æ¶ˆæ¯
            //if (!userMessage) return; // å¦‚æœæ²’æœ‰è¼¸å…¥æ¶ˆæ¯ï¼Œå‰‡è¿”å›

            // é¿å…ç›´æ¥ä½¿ç”¨ innerHTMLï¼Œè½¬ä¹‰ç”¨æˆ·è¾“å…¥
            const formattedUserMessage = userMessage.replace(/\n/g, '<br>').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            chatHistory.push({ sender: 'user', text: formattedUserMessage }); // å°‡ä½¿ç”¨è€…æ¶ˆæ¯æ·»åŠ åˆ°èŠå¤©æ­·å²
            updateChatBox(); // æ›´æ–°èŠå¤©æ¡†
            document.getElementById("userMessage").value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†

            // é€é AJAX ç™¼é€æ¶ˆæ¯åˆ°å¾Œç«¯
            fetch('docker.php', {
                method: 'POST', // è«‹æ±‚æ–¹æ³•ç‚º POST
                headers: { 'Content-Type': 'application/json' }, // è¨­å®šè«‹æ±‚é ­
                body: JSON.stringify({ message: userMessage, history: chatHistory }) // è«‹æ±‚é«”ï¼Œç™¼é€ä½¿ç”¨è€…æ¶ˆæ¯å’ŒèŠå¤©æ­·å²
            })
            .then(response => response.json()) // è§£æå›æ‡‰ç‚º JSON
            .then(data => {
                // å°‡æ©Ÿå™¨äººå›è¦†çš„æ®µè½ç”¨ <br> åˆ†éš”
                const formattedReply = data.reply.replace(/\n/g, '<br>'); // å°‡æ›è¡Œç¬¦æ›¿æ›ç‚º <br> æ¨™ç±¤
                chatHistory.push({ sender: 'bot', text: formattedReply }); // å°‡æ ¼å¼åŒ–å¾Œçš„å›è¦†æ·»åŠ åˆ°èŠå¤©æ­·å²
                updateChatBox(); // æ›´æ–°èŠå¤©æ¡†
                saveChatHistory(pageIdentifier); // ä¿å­˜èŠå¤©æ­·å²åˆ° localStorage
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }




/*        
        function updateChatBox() {
            const chatBox = document.getElementById("chatBox"); // ç²å–èŠå¤©æ¡†å…ƒç´ 
            chatBox.innerHTML = ''; // æ¸…ç©ºèŠå¤©æ¡†å…§å®¹
            chatHistory.forEach(message => { // éæ­·èŠå¤©æ­·å²
                const msgElement = document.createElement("div"); // å‰µå»ºä¸€å€‹æ–°çš„ div å…ƒç´ 
                msgElement.classList.add("message"); // æ·»åŠ æ¶ˆæ¯æ¨£å¼
                msgElement.classList.add(message.sender === 'user' ? "user-message" : "bot-message"); // æ ¹æ“šæ¶ˆæ¯ç™¼é€è€…æ·»åŠ å°æ‡‰çš„æ¨£å¼
                // æ›¿æ›ä½¿ç”¨è€…æ¶ˆæ¯ä¸­çš„æ›è¡Œç¬¦ç‚º<br>ä»¥ä¾¿æ–¼é¡¯ç¤º
                msgElement.innerHTML = message.text.replace(/\n/g, '<br>'); // ä½¿ç”¨ innerHTML ä¾†æ”¯æ´æ›è¡Œæ¨™ç±¤
                msgElement.style.fontSize = fontSize + 'px'; // è¨­å®šå­—é«”å¤§å°
                chatBox.appendChild(msgElement); // å°‡æ¶ˆæ¯å…ƒç´ æ·»åŠ åˆ°èŠå¤©æ¡†
            });
            chatBox.scrollTop = chatBox.scrollHeight; // è®“èŠå¤©æ¡†æ»¾å‹•åˆ°åº•éƒ¨
        }

        function sendMessage() {
            const userMessage = document.getElementById("userMessage").value; // ç²å–ä½¿ç”¨è€…è¼¸å…¥çš„æ¶ˆæ¯
            if (!userMessage) return; // å¦‚æœæ²’æœ‰è¼¸å…¥æ¶ˆæ¯ï¼Œå‰‡è¿”å›
            const formattedUserMessage = userMessage.replace(/\n/g, '<br>'); // å°‡æ›è¡Œç¬¦æ›¿æ›ç‚º <br> æ¨™ç±¤
            chatHistory.push({ sender: 'user', text: formattedUserMessage }); // å°‡ä½¿ç”¨è€…æ¶ˆæ¯æ·»åŠ åˆ°èŠå¤©æ­·å²
            updateChatBox(); // æ›´æ–°èŠå¤©æ¡†
            document.getElementById("userMessage").value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
            // é€é AJAX ç™¼é€æ¶ˆæ¯åˆ°å¾Œç«¯
            fetch('chatbot.php', {
                method: 'POST', // è«‹æ±‚æ–¹æ³•ç‚º POST
                headers: { 'Content-Type': 'application/json' }, // è¨­å®šè«‹æ±‚é ­
                body: JSON.stringify({ message: userMessage, history: chatHistory }) // è«‹æ±‚é«”ï¼Œç™¼é€ä½¿ç”¨è€…æ¶ˆæ¯å’ŒèŠå¤©æ­·å²
            })
            .then(response => response.json()) // è§£æå›æ‡‰ç‚º JSON
            .then(data => {
                // å°‡æ©Ÿå™¨äººå›è¦†çš„æ®µè½ç”¨ <br> åˆ†éš”
                const formattedReply = data.reply.replace(/\n/g, '<br>'); // å°‡æ›è¡Œç¬¦æ›¿æ›ç‚º <br> æ¨™ç±¤
                chatHistory.push({ sender: 'bot', text: formattedReply }); // å°‡æ ¼å¼åŒ–å¾Œçš„å›è¦†æ·»åŠ åˆ°èŠå¤©æ­·å²
                updateChatBox(); // æ›´æ–°èŠå¤©æ¡†
                saveChatHistory(pageIdentifier); // ä¿å­˜èŠå¤©æ­·å²åˆ° localStorage
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
*/
        // æ–°å¢å°è©±
        function addConversation() {
            Swal.fire({
                title: 'è«‹è¼¸å…¥å°è©±æ¨™é¡Œ',
                input: 'text',
                showCancelButton: true,
                confirmButtonText: 'æ–°å¢',
                cancelButtonText: 'å–æ¶ˆ',
                inputValidator: (value) => {
                    if (!value) {
                        return 'è«‹è¼¸å…¥å°è©±æ¨™é¡Œ';
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const title = result.value;
                    const newIdentifier = 'conv1_' + conversationTitles.length;
                    conversationTitles.push({ title, identifier: newIdentifier });
                    saveConversationTitles();
                    updateConversationList();
                    chatHistory = [];
                    pageIdentifier = newIdentifier;
                    updateChatBox();
                    highlightSelectedItem(newIdentifier);
                }
            });
        }

        // æ›´æ–°å°è©±æ¨™é¡Œåˆ—è¡¨
        function updateConversationList() {
            const conversationList = document.getElementById("conversationList"); // ç²å–å°è©±æ¨™é¡Œåˆ—è¡¨å…ƒç´ 
            conversationList.innerHTML = ''; // æ¸…ç©ºå°è©±æ¨™é¡Œåˆ—è¡¨å…§å®¹
            conversationTitles.forEach(item => { // éæ­·å°è©±æ¨™é¡Œæ•¸çµ„
                const titleElement = document.createElement("li"); // å‰µå»ºä¸€å€‹æ–°çš„ li å…ƒç´ 
                titleElement.classList.add("list-group-item", "d-flex", "justify-content-between", "align-items-center"); // æ·»åŠ æ¸…å–®é …ç›®æ¨£å¼
                titleElement.textContent = item.title; // è¨­å®šå°è©±æ¨™é¡Œç‚ºæ¸…å–®é …ç›®æ–‡å­—
                titleElement.dataset.identifier = item.identifier; // æ·»åŠ  data-attribute çµ¦è¾¨è­˜

                // å‰µå»ºä¸€å€‹å®¹å™¨ä¾†æ”¾ç·¨è¼¯ç¬¦è™Ÿã€åƒåœ¾æ¡¶ç¬¦è™Ÿã€æ‹–æ›³ç¬¦è™Ÿå’Œå¦å­˜æ–°æª”ç¬¦è™Ÿ
                const iconsContainer = document.createElement("div");
                iconsContainer.classList.add("icons-container");

                // æ·»åŠ ç·¨è¼¯ç¬¦è™Ÿ
                const editIcon = document.createElement("span");
                editIcon.classList.add("edit-icon");
                editIcon.innerHTML = "âœï¸";
                editIcon.addEventListener("click", () => editConversation(item.identifier));
                iconsContainer.appendChild(editIcon); // å°‡ç·¨è¼¯ç¬¦è™Ÿæ·»åŠ åˆ°åœ–æ¨™å®¹å™¨

                // æ·»åŠ åƒåœ¾æ¡¶ç¬¦è™Ÿ
                const deleteIcon = document.createElement("span");
                deleteIcon.classList.add("delete-icon");
                deleteIcon.innerHTML = "&#128465;"; // åƒåœ¾æ¡¶ç¬¦è™Ÿ
                deleteIcon.addEventListener("click", () => deleteConversation(item.identifier));
                iconsContainer.appendChild(deleteIcon); // å°‡åƒåœ¾æ¡¶ç¬¦è™Ÿæ·»åŠ åˆ°åœ–æ¨™å®¹å™¨

                // æ·»åŠ å¦å­˜æ–°æª”ç¬¦è™Ÿ
                const saveIcon = document.createElement("span");
                saveIcon.classList.add("save-icon");
                saveIcon.innerHTML = "ğŸ’¾";
                saveIcon.addEventListener("click", () => saveConversationToFile(item.identifier));
                iconsContainer.appendChild(saveIcon); // å°‡å¦å­˜æ–°æª”ç¬¦è™Ÿæ·»åŠ åˆ°åœ–æ¨™å®¹å™¨

                // æ·»åŠ æ‹–æ›³ç¬¦è™Ÿ
                const dragIcon = document.createElement("span");
                dragIcon.classList.add("drag-icon");
                dragIcon.innerHTML = "â˜°";
                dragIcon.setAttribute("draggable", "true");
                dragIcon.addEventListener("dragstart", (e) => dragStart(e, item.identifier));
                dragIcon.addEventListener("dragover", (e) => dragOver(e));
                dragIcon.addEventListener("drop", (e) => drop(e, item.identifier));
                iconsContainer.appendChild(dragIcon); // å°‡æ‹–æ›³ç¬¦è™Ÿæ·»åŠ åˆ°åœ–æ¨™å®¹å™¨

                titleElement.appendChild(iconsContainer); // å°‡åœ–æ¨™å®¹å™¨æ·»åŠ åˆ°æ¸…å–®é …ç›®

                titleElement.onclick = function() { // æ·»åŠ é»æ“Šäº‹ä»¶ç›£è½å™¨
                    saveChatHistory(pageIdentifier); // å„²å­˜ç•¶å‰çš„èŠå¤©æ­·å²
                    pageIdentifier = item.identifier; // æ›´æ–°é é¢è­˜åˆ¥ç¬¦
                    loadChatHistory(item.identifier); // è®€å–ä¸¦é¡¯ç¤ºé¸å–æ¨™é¡Œçš„èŠå¤©æ­·å²
                    highlightSelectedItem(item.identifier); // çªå‡ºé¡¯ç¤ºæ–°é¸æ“‡çš„é …ç›®
                };

                conversationList.appendChild(titleElement); // å°‡æ¸…å–®é …ç›®å…ƒç´ æ·»åŠ åˆ°å°è©±æ¨™é¡Œåˆ—è¡¨
            });
        }
        // åˆªé™¤å°è©±
        function deleteConversation(identifier) {
            if (confirm("ç¢ºå®šè¦åˆªé™¤é€™æ®µå°è©±å—ï¼Ÿ")) {
                // æ‰¾åˆ°ä¸¦åˆªé™¤å°è©±æ¨™é¡Œ
                const index = conversationTitles.findIndex(item => item.identifier === identifier);
                if (index !== -1) {
                    conversationTitles.splice(index, 1);
                    saveConversationTitles(); // ä¿å­˜å°è©±æ¨™é¡Œåˆ° localStorage
                    updateConversationList(); // æ›´æ–°å°è©±æ¨™é¡Œåˆ—è¡¨
                }

                // å¦‚æœåˆªé™¤çš„å°è©±æ˜¯æ­£åœ¨é¡¯ç¤ºçš„å°è©±ï¼Œå‰‡æ¸…ç©ºèŠå¤©æ­·å²
                if (identifier === pageIdentifier) {
                    chatHistory = [];
                    updateChatBox();
                    pageIdentifier = window.location.pathname.replace(/\//g, '') || 'defaultPage';
                    highlightSelectedItem(pageIdentifier);
                }

                // åˆªé™¤å°è©±æ­·å²
                localStorage.removeItem(identifier + '_chatHistory');
            }
        }
        // æ‹–æ›³é–‹å§‹
        let draggedItem = null;
        function dragStart(e, identifier) {
            draggedItem = identifier;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', null);
            e.currentTarget.classList.add('dragging');
        }

        // æ‹–æ›³ç§»å‹•
        function dragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        // æ‹–æ›³æ”¾é–‹
        function drop(e, identifier) {
            e.preventDefault();
            if (draggedItem && draggedItem !== identifier) {
                const draggedIndex = conversationTitles.findIndex(item => item.identifier === draggedItem);
                const targetIndex = conversationTitles.findIndex(item => item.identifier === identifier);

                if (draggedIndex !== -1 && targetIndex !== -1) {
                    // äº¤æ›å°è©±æ¨™é¡Œçš„ä½ç½®
                    [conversationTitles[draggedIndex], conversationTitles[targetIndex]] = [conversationTitles[targetIndex], conversationTitles[draggedIndex]];
                    saveConversationTitles(); // ä¿å­˜å°è©±æ¨™é¡Œåˆ° localStorage
                    updateConversationList(); // æ›´æ–°å°è©±æ¨™é¡Œåˆ—è¡¨
                }
            }
            e.currentTarget.classList.remove('dragging');
        }



        // ç·¨è¼¯å°è©±æ¨™é¡Œ
        function editConversation(identifier) {
            const index = conversationTitles.findIndex(item => item.identifier === identifier);
            if (index === -1) return;

            Swal.fire({
                title: 'è«‹è¼¸å…¥æ–°çš„å°è©±æ¨™é¡Œ',
                input: 'text',
                inputValue: conversationTitles[index].title,
                showCancelButton: true,
                confirmButtonText: 'ç·¨è¼¯',
                cancelButtonText: 'å–æ¶ˆ',
                inputValidator: (value) => {
                    if (!value) {
                        return 'è«‹è¼¸å…¥å°è©±æ¨™é¡Œ';
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const newTitle = result.value;
                    if (newTitle && newTitle !== conversationTitles[index].title) {
                        conversationTitles[index].title = newTitle;
                        saveConversationTitles(); // ä¿å­˜å°è©±æ¨™é¡Œåˆ° localStorage
                        updateConversationList(); // æ›´æ–°å°è©±æ¨™é¡Œåˆ—è¡¨
                    }
                }
            });
        }

        let fontSize = 14; // åˆå§‹åŒ–å­—é«”å¤§å°

        // è®Šæ›´å­—é«”å¤§å°
        function changeFontSize(action) {
            const chatBox = document.getElementById("chatBox"); // ç²å–èŠå¤©æ¡†å…ƒç´ 
            const messages = chatBox.getElementsByClassName("message"); // ç²å–æ‰€æœ‰æ¶ˆæ¯å…ƒç´ 

            if (action === 'increase') {
                fontSize += 1; // å­—é«”å¤§å°å¢åŠ  1px
            } else if (action === 'decrease') {
                fontSize -= 1; // å­—é«”å¤§å°æ¸›å°‘ 1px
            }

            // ç¢ºä¿å­—é«”å¤§å°åœ¨åˆç†ç¯„åœå…§
            if (fontSize < 12) fontSize = 10;
            if (fontSize > 24) fontSize = 24;

            // è¨­å®šæ‰€æœ‰æ¶ˆæ¯å…ƒç´ çš„å­—é«”å¤§å°
            for (let i = 0; i < messages.length; i++) {
                messages[i].style.fontSize = fontSize + 'px';
            }
        }

        // å¦å­˜å°è©±å…§å®¹åˆ°æ–‡å­—æª”
        function saveConversationToFile(identifier) {
            const chatHistory = localStorage.getItem(identifier + '_chatHistory'); // ç²å–èŠå¤©æ­·å²
            if (!chatHistory) return; // å¦‚æœæ²’æœ‰èŠå¤©æ­·å²ï¼Œè¿”å›

            const chatData = JSON.parse(chatHistory); // è§£æèŠå¤©æ­·å²
            let chatText = ''; // åˆå§‹åŒ–èŠå¤©æ–‡å­—

            chatData.forEach((message, index) => {
                // å°‡ <br> æ¨™ç±¤æ›¿æ›ç‚ºæ›è¡Œç¬¦è™Ÿ
                const formattedMessage = message.text.replace(/<br>/g, '\n');
                chatText += (index + 1) + '. ' + formattedMessage + '\n';
            }); // çµ„åˆèŠå¤©æ–‡å­—

            // æ‰¾åˆ°å°æ‡‰çš„å°è©±æ¨™é¡Œ
            const conversationTitle = conversationTitles.find(item => item.identifier === identifier)?.title || 'å°è©±';

            const blob = new Blob([chatText], { type: 'text/plain' }); // å»ºç«‹ Blob ç‰©ä»¶
            const url = URL.createObjectURL(blob); // å»ºç«‹ URL ç‰©ä»¶
            const a = document.createElement("a"); // å»ºç«‹è¶…é€£çµå…ƒç´ 
            a.href = url; // è¨­å®šè¶…é€£çµ URL
            a.download = conversationTitle + '.txt'; // ä½¿ç”¨å°è©±æ¨™é¡Œä½œç‚ºæª”æ¡ˆåç¨±
            document.body.appendChild(a); // å°‡è¶…é€£çµå…ƒç´ åŠ å…¥ body
            a.click(); // é»æ“Šè¶…é€£çµå…ƒç´ 
            document.body.removeChild(a); // ç§»é™¤è¶…é€£çµå…ƒç´ 
            URL.revokeObjectURL(url); // é‡‹æ”¾ URL ç‰©ä»¶
        }

        // é é¢åŠ è¼‰æ™‚è®€å–èŠå¤©æ­·å²å’Œå°è©±æ¨™é¡Œ
        window.onload = function() {
            loadConversationTitles(); // å…ˆè®€å–å°è©±æ¨™é¡Œ
            if (conversationTitles.length === 0) {
                addConversation(); // å¦‚æœæ²’æœ‰å°è©±æ¨™é¡Œï¼Œæ–°å¢ä¸€å€‹
            } else {
                loadChatHistory(pageIdentifier); // è®€å–ç•¶å‰å°è©±æ¨™é¡Œçš„èŠå¤©æ­·å²
            }
        };
    </script>
</body>
</html>
